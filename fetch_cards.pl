#!/usr/bin/perl

use strict;
use MTG::Database;
use MTG::GathererLoader;
use URI::Escape;
use Time::HiRes qw( usleep ualarm gettimeofday tv_interval nanosleep
                    clock_gettime clock_getres clock_nanosleep clock
                    stat );

my $agent = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_5_8) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2';

#my @multiverseids = (370553..370825); #(174808, 174922);
#my @multiverseids = (249695..249719); #(174808, 174922);
#my @multiverseids = qw/169958 169963 169971 169975 169977 170971 170977 170978 170982 170987 170991 170993 170995 170998 171001 171012 177500 177501 177505 177517 177530 177541 177542 177543 177546 177549 177551 177558 177571 177584 177585 177586 178109 178113 178115 178119 178121 178131 178134 178135 178136 178137 178138 178140 178144 178145 178150 178151 180115 180127 180134 180346 180347 180348 180350 180352 180360 180361 180362 180408 180411 180415 180423 180435 180447 180448 180454 180455 180457 180458 180465 180467 180473 180482 180493 180495 180498 180505 180509 183403 183414 183417 183418 185694 185696 185697 185698 185699 185701 185703 185704 185707 185709 185711 185712 185727 185734 185737 185743 185749 185751 185752 186309 186316 186320 186321 186322 186324 188999 189001 189006 189620 189621 189624 189625 189626 189627 189629 189631 189635 189636 189637 189638 190393 190394 190395 190396 190397 190398 190399 190400 190401 190404 190405 190406 190407 190408 190410 190411 190412 190413 190414 190417 190418 190420 191353 191355 191356 191359 191360 191361 191368 191369 191371 191372 191373 191374 191376 192209 192210 192211 192212 192214 192215 192217 192219 192220 192221 192222 192223 192224 192225 192226 192227 192229 192230 192231 192232 193394 193396 193397 193398 193399 193400 193403 193404 193405 193406 193407 195402 195403 195572 195626 195627 195628 195629 195630 195631 195632 195634 195635 197402 197403 197404 197405 197406 197407 197526 197527 197528 197529 197530 197531 197532 197533 197534 197535 197536 197537 197538 197887 197889 197890 197891 197892 197893 198519 198523 198524 201962 201964 201967 201972 201978/; #Zendikar
#my @multiverseids = qw/171007 177508 177520 177545 177560 177583 180412 180416 189159 189162 189163 189180 189181 191540 191547 191548 191549 191552 191557 191569 191570 191577 191578 191580 191581 193970 193975 193982 193994 193998 194002 194003 194007 194012 194017 194018 194671 194672 194675 194678 194679 194681 194686 194699 194700 194703 194706 194708 194714 194718 195297 195307 197118 197125 197129 197137 197145 197152 197153 197154 197159 197160 197162 197758 197759 197763 197765 197766 197767 197769 197770 197771 197785 197786 197787 197788 197789 197836 197840 197843 197844 197853 197854 197855 197856 197857 197859 197864 197865 197866 197869 197870 197871 197872 197873 197874 197875 197877 197880 197881 197959 197968 197973 198356 198357 198360 198361 198362 198364 198367 198368 198370 198371 198372 198374 198375 198376 198378 198382 198383 198384 198386 198390 198392 198393 198394 198395 198396 198400 198401 198402 201560 201561 201562 201563 201565 201566 201568 201570 201571 201573 201575 201578 201579 205425/; # Worldwake

#my @multiverseids = qw/373661 373712 373543 373578 373590 373550 373530 373604 373584 373671 373677 373715 373740 373585 373742 373506 373689 373500 373631 373720 373612 373627 373583 373544 373638 373642 373509 373659 373714 373603 373636 373730 373620 373684 373726 373503 373594 373521 373561 373621 373707 373555 373656 373513 373588 373542 373660 373504 373525 373664 373593 373577 373623 373537 373678 373520 373557 373648 373634 373649 373597 373724 373589 373745 373641 373606 373576 373511 373686 373596 373674 373703 373552 373514 373705 373562 373501 373528 373625 373625 373625 373625 373682 373566 373691 373516 373645 373519 373605 373587 373524 373729 373575 373616 373738 373628 373708 373668 373673 373545 373670 373595 373595 373595 373595 373538 373548 373710 373586 373599 373610 373680 373523 373600 373651 373731 373629 373704 373579 373536 373675 373741 373699 373698 373727 373658 373565 373746 373746 373746 373746 373694 373650 373581 373564 373719 373713 373559 373498 373510 373580 373733 373693 373611 373646 373619 373553 373647 373696 373507 373592 373722 373569 373657 373533 373533 373533 373533 373716 373549 373667 373643 373614 373617 373635 373626 373695 373556 373505 373669 373663 373672 373739 373725 373570 373532 373644 373508 373601 373744 373728 373737 373602 373692 373652 373517 373653 373718 373697 373515 373574 373637 373702 373676 373573 373598 373529 373618 373717 373732 373554 373591 373539 373687 373679 373721 373567 373567 373567 373567 373701 373624 373711 373734 373571 373522 373560 373535 373662 373735 373632 373633 373630 373607 373541 373690 373512 373685 373531 373551 373639 373540 373665 373666 373743 373640 373547 373499 373527 373518 373655 373613 373534 373709 373526 373563 373622 373502 373572/; # Theros

#my @multiverseids = qw/146729/; #Sunken Ruins test

my @multiverseids;
while (<STDIN>) { # read ids from STDIN
    chomp;
    if (/^\d+$/) {
	push @multiverseids, $_;
    }
}
my $stopper = 0;
foreach my $id (@multiverseids) {
    my $url = 'http://gatherer.wizards.com/Pages/Card/Details.aspx?multiverseid=' . $id;
    my $cmd = 'curl -s -L -A ' . "'" . $agent . "' " . $url . ' > card_html/' . $id . '.html';
    if (! -e 'card_html/' . $id . '.html' || -s 'card_html/' . $id . '.html' < 10000) {
	printf("%d (%03.2f%% - %d of %d)\n", $id, 100.0 * $stopper / (1.0 * scalar(@multiverseids)), $stopper, scalar(@multiverseids));
	`$cmd`;
	usleep(1000000 + (rand() * 10000000));
    } else {
	print "skipping $id - I already have it.\n";
    }
    $stopper++;
    #last if ($stopper > 160);
}

my @names = ("Animar, Soul of Elements",
"Forest",
"Island",
"Mountain",
"Novijen, Heart of Progress",
"Simic Growth Chamber",
"Valakut, the Molten Pinnacle",
"Rupture Spire",
"Kazandu Refuge",
"Izzet Boilerworks",
"Homeward Path",
"Gruul Turf",
"Evolving Wilds",
"Command Tower",
"Vivid Grove",
"Vivid Creek",
"Vivid Crag",
"Temple of the False God",
"Fungal Reaches",
"Garruk Wildspeaker",
"Hull Breach",
"Hunting Pack",
"Soul's Might",
"Colossal Might",
"Electropotence",
"Lead the Stampede",
"Strength of the Tajuru",
"Fastbond",
"Pemmin's Aura",
"Soul's Fire",
"Ruination",
"Ray of Command",
"Invert the Skies",
"Exclude",
"Essence Scatter",
"Dissipate",
"Fuel for the Cause",
"Negate",
"Cancel",
"Spellbook",
"Eldrazi Monument",
"Lightning Greaves",
"Intet, the Dreamer",
"Deadly Recluse",
"Inkwell Leviathan",
"Grozoth",
"Verdant Force",
"Borborygmos",
"Bringer of the Red Dawn",
"Liege of the Tangle",
"Fierce Empath",
"Artisan of Kozilek",
"Ulamog, the Infinite Gyre",
"Primordial Sage",
"Drumhunter",
"Lumberknot",
"Falkenrath Marauders",
"Scourge of Geier Reach",
"Murder of Crows",
"Bellowing Tanglewurm",
"Garruk's Packleader",
"Riku of Two Reflections",
"Rapacious One",
"Hydra Omnivore",
"Magmatic Force",
"Simic Sky Swallower",
"Carnage Wurm",
"Primordial Hydra",
"Palinchron",
"Jin-Gitaxias, Core Augur",
"Symbiotic Wurm",
"Stingerfling Spider",
"Grazing Gladehart",
"Ulamog's Crusher",
"Wall of Frost",
"Phyrexian Metamorph",
"Bringer of the Green Dawn",
"Experiment Kraj",
"Grim Lavamancer",
"Hellspark Elemental",
"Jackal Pup",
"Jaya Ballard, Task Mage",
"Keldon Champion",
"Keldon Marauders",
"Mogg Fanatic",
"Mogg Flunkies",
"Spark Elemental",
"Vulshok Sorcerer",
"Browbeat",
"Chain Lightning",
"Fireball",
"Fireblast",
"Flames of the Blood Hand",
"Hammer of Bogardan",
"Lightning Bolt",
"Pillage",
"Price of Progress",
"Reverberate",
"Sudden Impact",
"Thunderbolt",
"Inkmoth Nexus",
"Misty Rainforest",
"Blighted Agent",
"Glistener Elf",
"Ichorclaw Myr",
"Apostle's Blessing",
"Distortion Strike",
"Gitaxian Probe",
"Groundswell",
"Livewire Lash",
"Mutagenic Growth",
"Vines of Vastwood",
"Nature's Claim",
"Spell Pierce",
"Spellskite",
"Viridian Corrupter",
"Swamp",
"Ghost Quarter",
"Liliana of the Veil",
"Bloodline Keeper",
"Victim of Night",
"Moan of the Unhallowed",
"Vampiric Fury",
"Galvanic Juggernaut",
"Furor of the Bitten",
"Ghoulraiser",
"Infernal Plunge",
"Feral Ridgewolf",
"Manor Skeleton",
"Walking Corpse",
"Night Revelers",
"Scourge of Geier Reach",
"Stromkirk Patrol",
"Geistflame",
"Into the Maw of Hell",
"Dead Weight",
"Tribute to Hunger",
"Manor Skeleton",
"Spectral Flight",
"Wooden Stake",
"Corpse Lunge",
"Forbidden Alchemy",
"Tormented Pariah",
"Night Terrors",
"Curse of Oblivion",
"Gruesome Deformity",
"Moonmist",
"Cobbled Wings",
"Kindercatch",
"Past in Flames",
"Rooftop Storm",
"Heretic's Punishment",
"Unburial Rites",
"Frightful Delusion",
"Memory's Journey",
"Claustrophobia",
"Burning Vengeance",
"Plains",
"Gavony Township",
"Avacyn's Pilgrim",
"Elite Inquisitor",
"Gideon's Lawkeeper",
"Serra Angel",
"Suture Priest",
"Hero of Bladehold",
"Tree of Redemption",
"Mirran Crusader",
"Caravan Vigil",
"Guardians' Pledge",
"Sickleslicer",
"Honor of the Pure",
"Shrine of Loyal Legions",
"Travel Preparations",
"Bonds of Faith",
"Mask of Avacyn",
"Timely Reinforcements",
"Plains",
"Swamp",
"Bloodline Keeper",
"Cloistered Youth",
"Diregraf Ghoul",
"Doomed Traveler",
"Markov Patrician",
"Screeching Bat",
"Skirsdag High Priest",
"Stromkirk Patrol",
"Thraben Purebloods",
"Thraben Sentry",
"Unruly Mob",
"Walking Corpse",
"Altar's Reap",
"Curse of Death's Hold",
"Ghoulcaller's Chant",
"Midnight Haunting",
"Moment of Heroism",
"Smite the Monstrous",
"Unburial Rites",
"Civilized Scholar",
"Creeping Renaissance",
"Curse of the Bloody Tome",
"Dream Twist",
"Frightful Delusion",
"Ghostly Possession",
"Hysterical Blindness",
"Infernal Plunge",
"Intangible Virtue",
"Invisible Stalker",
"Memory's Journey",
"Moonmist",
"Nightbird's Clutches",
"Paraselene",
"Runic Repetition",
"Spare from Evil",
"Woodland Sleuth",
"Bloodgift Demon",
"Bloodline Keeper",
"Cloistered Youth",
"Diregraf Ghoul",
"Doomed Traveler",
"Markov Patrician",
"Screeching Bat",
"Skirsdag High Priest",
"Stromkirk Patrol",
"Thraben Purebloods",
"Thraben Sentry",
"Unruly Mob",
"Walking Corpse",
"Altar's Reap",
"Curse of Death's Hold",
"Ghoulcaller's Chant",
"Midnight Haunting",
"Moment of Heroism",
"Smite the Monstrous",
"Unburial Rites",
"Civilized Scholar",
"Creeping Renaissance",
"Curse of the Bloody Tome",
"Dream Twist",
"Frightful Delusion",
"Ghostly Possession",
"Hysterical Blindness",
"Infernal Plunge",
"Intangible Virtue",
"Invisible Stalker",
"Memory's Journey",
"Moonmist",
"Nightbird's Clutches",
"Paraselene",
"Runic Repetition",
"Spare from Evil",
"Ashmouth Hound",
"Bloodcrazed Neonate",
"Delver of Secrets",
"Feral Ridgewolf",
"Kessig Wolf",
"Lantern Spirit",
"Rage Thrower",
"Rakish Heir",
"Skirsdag Cultist",
"Village Ironsmith",
"Brimstone Volley",
"Butcher's Cleaver",
"Feeling of Dread",
"Forbidden Alchemy",
"Geistflame",
"Into the Maw of Hell",
"Silent Departure",
"Think Twice",
"Traitorous Blood",
"Traveler's Amulet",
"Altar's Reap",
"Frightful Delusion",
"Furor of the Bitten",
"Ghost Quarter",
"Gnaw to the Bone",
"Kessig Wolf",
"Maw of the Mire",
"Mulch",
"Orchard Spirit",
"Purify the Grave",
"Skeletal Grimace",
"Spare from Evil",
"Spider Spawning",
"Spidery Grasp",
"Vampire Interloper",
"Vampiric Fury",
"Wreath of Geists",
"Ambush Viper",
"Avacynian Priest",
"Darkthicket Wolf",
"Festerhide Boar",
"Fiend Hunter",
"Galvanic Juggernaut",
"Hamlet Captain",
"Lumberknot",
"Selfless Cathar",
"Village Bell-Ringer",
"Villagers of Estwald",
"Voiceless Spirit",
"Woodland Sleuth",
"Blazing Torch",
"Bonds of Faith",
"Prey Upon",
"Ranger's Guile",
"Rebuke",
"Sharpened Pitchfork",
"Smite the Monstrous",
"Spidery Grasp",
"Ancient Grudge",
"Doomed Traveler",
"Gnaw to the Bone",
"Grizzled Outcasts",
"Inquisitor's Flail",
"Kindercatch",
"Make a Wish",
"Manor Skeleton",
"Maw of the Mire",
"Moonmist",
"Paraselene",
"Rooftop Storm",
"Thraben Purebloods",
"Urgent Exorcism",
"Woodland Sleuth",
"Ashmouth Hound",
"Bloodcrazed Neonate",
"Geistcatcher's Rig",
"Kruin Outlaw",
"Markov Patrician",
"Pitchburn Devils",
"Rage Thrower",
"Riot Devils",
"Scourge of Geier Reach",
"Skirsdag Cultist",
"Stromkirk Noble",
"Village Cannibals",
"Village Ironsmith",
"Army of the Damned",
"Blazing Torch",
"Bump in the Night",
"Butcher's Cleaver",
"Corpse Lunge",
"Dead Weight",
"Harvest Pyre",
"Heretic's Punishment",
"Moan of the Unhallowed",
"Tribute to Hunger",
"Victim of Night",
"Ambush Viper",
"Ancient Grudge",
"Boneyard Wurm",
"Ghoulraiser",
"Graveyard Shovel",
"Moldgraf Monstrosity",
"Night Terrors",
"Rally the Peasants",
"Ranger's Guile",
"Selfless Cathar",
"Shimmering Grotto",
"Spider Spawning",
"Stromkirk Patrol",
"Tree of Redemption",
"Ulvenwald Mystics",
"Vampiric Fury",
"Armored Skaab",
"Avacyn's Pilgrim",
"Darkthicket Wolf",
"Gatstaf Shepherd",
"Hollowhenge Scavenger",
"Ludevic's Test Subject",
"Makeshift Mauler",
"Mayor of Avabruck",
"Moon Heron",
"Murder of Crows",
"One-Eyed Scarecrow",
"Orchard Spirit",
"Pitchburn Devils",
"Selhoff Occultist",
"Brimstone Volley",
"Caravan Vigil",
"Harvest Pyre",
"Prey Upon",
"Ranger's Guile",
"Spectral Flight",
"Spidery Grasp",
"Travel Preparations",
"Altar's Reap",
"Brain Weevil",
"Cobbled Wings",
"Curse of Oblivion",
"Curse of the Nightly Hunt",
"Feral Ridgewolf",
"Grave Bramble",
"Grizzled Outcasts",
"Mask of Avacyn",
"Naturalize",
"Sharpened Pitchfork",
"Thraben Sentry",
"Traitorous Blood",
"Wooden Stake",
"Ashmouth Hound",
"Battleground Geist",
"Fortress Crab",
"One-Eyed Scarecrow",
"Selhoff Occultist",
"Sturmgeist",
"Tormented Pariah",
"Burning Vengeance",
"Claustrophobia",
"Curse of the Bloody Tome",
"Desperate Ravings",
"Dissipate",
"Dream Twist",
"Forbidden Alchemy",
"Ghoulcaller's Bell",
"Into the Maw of Hell",
"Sensory Deprivation",
"Think Twice",
"Avacynian Priest",
"Back from the Brink",
"Bramblecrush",
"Curse of the Pierced Heart",
"Ghoulcaller's Chant",
"Hollowhenge Scavenger",
"Intangible Virtue",
"Laboratory Maniac",
"Lumberknot",
"Memory's Journey",
"Night Revelers",
"Past in Flames",
"Reckless Waif",
"Scourge of Geier Reach",
"Tormented Pariah",
"Typhoid Rats",
"Vampiric Fury",
"Witchbane Orb",
"Plains",
"Abbey Griffin",
"Champion of the Parish",
"Chapel Geist",
"Delver of Secrets",
"Doomed Traveler",
"Elder Cathar",
"Geist-Honored Monk",
"Invisible Stalker",
"Selfless Cathar",
"Spectral Rider",
"Stitcher's Apprentice",
"Unruly Mob",
"Voiceless Spirit",
"Dissipate",
"Feeling of Dread",
"Grasp of Phantoms",
"Lost in the Mist",
"Silver-Inlaid Dagger",
"Smite the Monstrous",
"Abbey Griffin",
"Cobbled Wings",
"Furor of the Bitten",
"Ghostly Possession",
"Gruesome Deformity",
"Heartless Summoning",
"Hysterical Blindness",
"Infernal Plunge",
"Nevermore",
"Night Terrors",
"Nightbird's Clutches",
"Sensory Deprivation",
"Somberwald Spider",
"Spare from Evil",
"Thraben Purebloods",
"Urgent Exorcism",
"Wooden Stake",
"Island",
"Swamp",
"Abattoir Ghoul",
"Armored Skaab",
"Battleground Geist",
"Deranged Assistant",
"Fortress Crab",
"Makeshift Mauler",
"Skaab Goliath",
"Snapcaster Mage",
"Stitched Drake",
"Stromkirk Patrol",
"Typhoid Rats",
"Vampire Interloper",
"Walking Corpse",
"Cackling Counterpart",
"Corpse Lunge",
"Curiosity",
"Dead Weight",
"Ghoulcaller's Chant",
"Grasp of Phantoms",
"Victim of Night",
"Bitterheart Witch",
"Brain Weevil",
"Creepy Doll",
"Fortress Crab",
"Ghoulcaller's Bell",
"Graveyard Shovel",
"Inquisitor's Flail",
"Intangible Virtue",
"Manor Skeleton",
"Moment of Heroism",
"Night Revelers",
"Nightbird's Clutches",
"Rebuke",
"Silverchase Fox",
"Typhoid Rats",
"Voiceless Spirit",
"Woodland Cemetery",
"Chandra's Phoenix",
"Goblin Guide",
"Grim Lavamancer",
"Hero of Oxid Ridge",
"Kargan Dragonlord",
"Plated Geopede",
"Koth of the Hammer",
"Burst Lightning",
"Lightning Bolt",
"Searing Blaze",
"Shrine of Burning Rage",
"Staggershock",
"Sword of War and Peace",
"Arid Mesa",
"Mountain",
"Scalding Tarn",
"Teetering Peaks",
"Act of Aggression",
"Arc Lightning",
"Combust",
"Dismember",
"Manabarbs",
"Manic Vandal",
"Vulshok Refugee",
"Lightning Elemental",
"Goblin Fireslinger",
"Devil's Play",
"Shrine of Burning Rage",
"Incinerate",
"Melt Terrain",
"Whipflare",
"Traitorous Blood",
"Tectonic Rift",
"Slagstorm",
"Brimstone Volley",
"Geosurge",
"Circle of Flame",
"Past in Flames",
"Artillerize",
"Cemetery Reaper",
"Skaab Goliath",
"Skaab Ruinator",
"Undead Alchemist",
"Geth, Lord of the Vault",
"Doom Blade",
"Diregraf Ghoul",
"Armored Skaab",
"Makeshift Mauler",
"Stitched Drake",
"Ghoulraiser",
"Abattoir Ghoul",
"Nested Ghoul",
"Cellar Door",
"Zombie Goliath",
"Moan of the Unhallowed",
"Memoricide",
"Call to the Grave",
"Gravedigger",
"Endless Ranks of the Dead",
"Rooftop Storm",
"Fallen Ferromancer",
"Fling",
"Arc Trail",
"Lightning Elemental",
"Gorehorn Minotaurs",
"Tectonic Rift",
"Invader Parasite",
"Crush",
"Chandra's Outrage",
"Feral Ridgewolf",
"Rofellos, Llanowar Emissary",
"Rootbound Crag", #4
"Copperline Gorge", #4
"Vorinclex, Voice of Hunger", #2
"Balefire Dragon", #2
"Melt Terrain", #4
"Tectonic Rift", #4
"Invader Parasite", #2
"Geosurge", #2
"Dawntreader Elk", #2
"Primeval Titan", #1
"Sword of Feast and Famine", #1
"Llanowar Elves", #4
"Giant Growth", #4
"Treefolk Harbinger",
"Unstoppable Ash",
"Seedguide Ash",
"Wall of Nets",
"Thorntooth Witch",
"Oakgnarl Warrior",
"Indomitable Ancients",
"Reach of Branches",
"Battlewand Oak",
"Fendeep Summoner",
"Sapling of Colfenor",
"Treefolk Seedlings",
"Bosk Banneret",
"Guard Duty",
"Archangel of Strife",
"Wall of Faith",
"Burrenton Shield-Bearers",
"Stalwart Shield-Bearers",
"Task Force",
"Sustainer of the Realm",
"Wall of Resistance",
"Blessed Orator",
"Crenellated Wall",
"Defender of the Order",
"Oathsworn Giant",
);
if (0) {
    my $db = MTG::Database->new();
    my $loader = MTG::GathererLoader->new($db);

    foreach my $name (@names) {
	my $res = $loader->fetchCardByName($name);
	`sleep 2` if ($res);
    }
}

